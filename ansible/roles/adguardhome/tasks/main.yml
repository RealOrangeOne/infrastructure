- name: Include vault
  include_vars: vault.yml

- name: Install adguardhome
  kewlfft.aur.aur:
    name: adguardhome-bin
  become: true

- name: Install config file
  template:
    src: files/adguardhome.yml
    dest: /var/lib/adguardhome/AdGuardHome.yaml
    validate: /var/lib/adguardhome/AdGuardHome --check-config --config %s
    owner: root
    mode: "0600"
  notify: restart adguardhome
  become: true

- name: Install coredns
  kewlfft.aur.aur:
    name: coredns
  become: true

- name: Install coredns config file
  template:
    src: files/Corefile
    dest: /etc/coredns/Corefile
    owner: coredns
    mode: "0644"
  notify: restart coredns
  become: true
